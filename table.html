<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Widget</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Martian+Mono:wght@100..800&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&family=Space+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
</head>
<body style="opacity: 0; transition: opacity 0.5s ease;">

<h1>EDI Parser Results</h1>
<div class="results-table-container" id="results-table-container">
    <div class="table-controls">
        <div class="filter-control">
            <button class="filter-btn" id="filterBtn">
                <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px" fill="currentColor">
                    <path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"/>
                </svg>
            </button>
                <div class="filter-dropdown" id="filterDropdown">
                    <div class="filter-section">
                        <h4>Filter Columns</h4>
                        <div class="filter-options">
                            <label class="filter-option">
                                <input type="checkbox" checked data-column="0">
                                <span class="checkmark"></span>
                                Patient Name
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" checked data-column="1">
                                <span class="checkmark"></span>
                                Patient ID
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" checked data-column="2">
                                <span class="checkmark"></span>
                                Service Date
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" checked data-column="3">
                                <span class="checkmark"></span>
                                Provider
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" checked data-column="4">
                                <span class="checkmark"></span>
                                Diagnosis
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" checked data-column="5">
                                <span class="checkmark"></span>
                                Amount
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <table class="results-table" id="results-table">
            <thead>
                <tr class="table-header">
                    <!-- Column headers will be dynamically added here -->
                </tr>
            </thead>
            <tbody class="table-body">
                <!-- Table rows will be dynamically added here -->
            </tbody>
        </table>
    </div>

    <div class="download-button-container" id="download-button-container">
        <button class="download-btn" id="download-btn">
            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="rgba(255, 255, 255, 0.8)">
                <path d="M480-320 280-520l56-58 104 104v-326h80v326l104-104 56 58-200 200ZM240-160q-33 0-56.5-23.5T160-240v-120h80v120h480v-120h80v120q0 33-23.5 56.5T720-160H240Z"/>
            </svg>
            <span class="download-text">Download</span>
        </button>
    </div>

<script>
// Filter functionality
document.addEventListener('DOMContentLoaded', function() {
    const filterBtn = document.getElementById('filterBtn');
    const filterDropdown = document.getElementById('filterDropdown');
    const filterCheckboxes = document.querySelectorAll('.filter-option input[type="checkbox"]');
    
    // Toggle filter dropdown
    filterBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        filterDropdown.classList.toggle('show');
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
        if (!filterDropdown.contains(e.target) && !filterBtn.contains(e.target)) {
            filterDropdown.classList.remove('show');
        }
    });
    
    // Handle column visibility
    filterCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const columnIndex = parseInt(this.dataset.column);
            const isVisible = this.checked;
            toggleColumnVisibility(columnIndex, isVisible);
        });
    });
    
    function toggleColumnVisibility(columnIndex, isVisible) {
        const table = document.getElementById('results-table');
        const headers = table.querySelectorAll('thead th');
        const rows = table.querySelectorAll('tbody tr');
        
        // Toggle header
        if (headers[columnIndex]) {
            headers[columnIndex].style.display = isVisible ? '' : 'none';
        }
        
        // Toggle cells in all rows
        rows.forEach(row => {
            const cell = row.children[columnIndex];
            if (cell) {
                cell.style.display = isVisible ? '' : 'none';
            }
        });
    }
});

// Function to display results in a themed table
function displayResultsTable(data) {
    const tableContainer = document.getElementById('results-table-container');
    const table = document.getElementById('results-table');
    const thead = table.querySelector('thead tr');
    const tbody = table.querySelector('tbody');
    
    // Clear existing content
    thead.innerHTML = '';
    tbody.innerHTML = '';
    
    if (!data || data.length === 0) {
        tableContainer.style.display = 'none';
        return;
    }
    
    // Get column headers from the first object
    const headers = Object.keys(data[0]);
    
    // Create header row
    headers.forEach(header => {
        const th = document.createElement('th');
        th.textContent = header;
        thead.appendChild(th);
    });
    
    // Create data rows
    data.forEach(row => {
        const tr = document.createElement('tr');
        headers.forEach(header => {
            const td = document.createElement('td');
            td.textContent = row[header] || '';
            tr.appendChild(td);
        });
        tbody.appendChild(tr);
    });
    
    // Show the table with fade in
    tableContainer.style.display = 'block';
    tableContainer.style.opacity = '1';
}

// Sample data to test the table
const sampleData = [
    {
        "Patient Name": "John Doe",
        "Patient ID": "12345",
        "Service Date": "2024-01-15",
        "Provider": "Dr. Smith",
        "Diagnosis": "Routine Checkup",
        "Amount": "$150.00"
    },
    {
        "Patient Name": "Jane Smith",
        "Patient ID": "67890",
        "Service Date": "2024-01-16",
        "Provider": "Dr. Johnson",
        "Diagnosis": "Physical Therapy",
        "Amount": "$80.00"
    },
    {
        "Patient Name": "Bob Wilson",
        "Patient ID": "54321",
        "Service Date": "2024-01-17",
        "Provider": "Dr. Brown",
        "Diagnosis": "Lab Work",
        "Amount": "$220.00"
    }
];

// Display the sample data when page loads
window.addEventListener('load', function() {
    // Fade in the page
    document.body.style.opacity = '1';
    
    // Display the table after a short delay
    setTimeout(() => {
        displayResultsTable(sampleData);
    }, 300);
});

// Download button functionality
document.getElementById('download-btn').addEventListener('click', function() {
    // Get the visible table data
    const table = document.getElementById('results-table');
    const rows = [];
    
    // Get headers (only visible columns)
    const headerRow = [];
    const headerCells = table.querySelectorAll('thead th');
    headerCells.forEach((cell, index) => {
        if (cell.style.display !== 'none') {
            headerRow.push(cell.textContent);
        }
    });
    rows.push(headerRow);
    
    // Get data rows (only visible columns)
    const dataRows = table.querySelectorAll('tbody tr');
    dataRows.forEach(row => {
        const rowData = [];
        const cells = row.querySelectorAll('td');
        cells.forEach((cell, index) => {
            if (cell.style.display !== 'none') {
                rowData.push(cell.textContent);
            }
        });
        if (rowData.length > 0) {
            rows.push(rowData);
        }
    });
    
    // Convert to CSV
    const csvContent = rows.map(row => 
        row.map(cell => `"${cell.replace(/"/g, '""')}"`).join(',')
    ).join('\n');
    
    // Create and download file
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', 'edi_parser_results.csv');
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
});
</script>

</body>
</html>